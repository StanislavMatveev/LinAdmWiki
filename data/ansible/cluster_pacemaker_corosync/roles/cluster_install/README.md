# Роль cluster_install

## Описание

Данная роль устанавливает и настраивает кластер Corosync + Pacemaker.
Роль адаптивная, т.е. не нужно указывать какое количество узлов вы используете, а все настройки осуществляются через переменные.
Если нод меньше 3, то роль отключит политику кворума, и не будет настраивать ноду "наблюдатель". Если больше 2, то кворум будет работать, и последняя нода всегда будет "наблюдателем" (защищена от миграции ресурсов и служит только для достижения кворума). Поскольку нода "наблюдатель", это всегда последняя нода, то если для этих целей планируется специальной машина (прим. малой мощности), то ее нужно располагать самой последней в группе нод файла inventory.
Если используется больше одного виртуального ip адреса, они будут объеденены в группу, чтобы pacemaker не распределял их по разным узлам.

## Переменные

*Переменные в каталоге defaults данной роли:*

- packages_for_install - основные пакеты для работы кластера

*Переменные которые необходимо указать в файлах group_vars:*

- Переменная с автоматической генерацией списка имен ипользуемых узлов (данные имена также будут присвоенны узлам кластера). Необходимо заменить имя группы "nodes" на свое.
nodes_list: "{{ groups['nodes'] | map('extract', hostvars, 'inventory_hostname') }}"

- Имя которое будет присвоенно кластеру.
cluster_name: test_cluster

- Пароль от пользователя "hacluster".
hacluster_pass: test

- Список виртуальных ip адресов, которые необходимо присвоить рабочему узлу кластера
virtual_ip_list:
  - 10.0.3.110
