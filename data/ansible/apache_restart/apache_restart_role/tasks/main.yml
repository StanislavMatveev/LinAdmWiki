---
# tasks file for apache_restart_role
- name: "Commenting upstream line {{ server_name }} in nginx"
  lineinfile:
    path: /etc/nginx/conf.d/upstream.conf
    regexp: "server {{ server_name }};"
    line: "\t#server {{ server_name }};"

- name: Checking nginx config
  shell:
    cmd: nginx -t

- name: Reloading nginx config
  shell:
    cmd: nginx -s reload

- name: "Restart apache({{ server_name }}) service"
  service:
    name: apache2
    state: restarted
  delegate_to: "{{ server_name }}"

- name: "Waiting to restarted apache({{ server_name }}) service"
  pause:
    seconds: 20

- name: "Uncommenting upstream line {{ server_name }} in nginx"
  lineinfile:
    path: /etc/nginx/conf.d/upstream.conf
    regexp: "#server {{ server_name }};"
    line: "\tserver {{ server_name }};"
