# Базовые нагрузочные тесты

*[[tests|<- Назад]]*

*[[index|<- На главную]]*
***
## Данные

**Исходные данные:**

- Две виртуальные машины VMware: Debian Bookworm, Ubuntu 24.04.
- Характеристики виртуальных машин идентичны: 1 Gb оперативной памяти, 1 ядро процессора.

**Цели:**

- Определить какие изменения происходят с машиной при критических нагрузках.

## Повышенная нагрузка на процессор

**Использовалось:**

- `stress -c 50`

**Результаты:**

- Процессор большую часть процессорного времени проводит в пространстве пользователя.
- load average показывает паттерн растущей нагрузки (первое значение больше второго и третьего), пока не выровняется.
- Скорость чтения и записи упала приблизительно на 20%-30%.
- На оперативную память почти не влияет.
- Скорость передачи данных по сети почти не изменилась.

## Недостаток оперативной памяти

**Использовалось:**

- Понижение лимита оперативной памяти до 512 Mb в гипервизоре
- `stress -m 5`

**Результаты:**

- При недостатке оперативной памяти подключается swap (если он есть).
- Процессор большую часть процессорного времени проводит в системном пространстве.
- Немного поднимается статистика по wa (операции ввода/вывода) в top.
- load average показывает паттерн растущей нагрузки (первое значение больше второго и третьего), пока не выровняется.
- Жесткий диск начинает работать почти на 100%.
- Скорость чтения и записи упала приблизительно на 50%-60%.
- Скорость передачи данных по сети упала приблизительно на 30%.

## Ограничение работы сети

**Использовалось:**

- Ограничение трафика до 128 Kbps

**Результаты:**

- При TCP соединении появляется разница между отправленными и полученными пакетами (полученных меньше).
- При TCP соединении появились пропуски (когда передалось 0.0), количество приблизительно 50/50.
- При UDP соединении отправленные пакеты не изменились, а вот полученные пакеты многократно снизились.

**Использовалось:**

- Ограничение трафика до 128 Kbps
- Потеря пакетов 20%

**Результаты:**

- При TCP соединении появляется разница между отправленными и полученными пакетами (полученных меньше).
- При TCP соединении появились пропуски (когда передалось 0.0), количество приблизительно 9 пропусков на 1 успешную отправку.
- При TCP соединении появились повторные попытки отправки (retr).
- При UDP соединении отправленные пакеты не изменились, а вот полученные пакеты многократно снизились.

**Использовалось:**

- Потеря пакетов 20%

**Результаты:**

- При TCP соединении появляется разница между отправленными и полученными пакетами (полученных меньше).
- При TCP соединении появились пропуски (когда передалось 0.0), количество приблизительно 9 пропусков на 1 успешную отправку.
- При TCP соединении появились повторные попытки отправки (retr).
- При UDP соединении показания почти такие же, как без ограничений, лишь на 20% снизился объем полученных пакетов.

**Выводы:**

- TCP соединение более чувствительно к уменьшению скорости и потере пакетов, т.к. оно является безопасным соединением и каждый раз будет ожидать подтверждения доставки пакета.
- UDP же посылает пакеты в сторону адресата, даже без проверки готов ли он их принять, поэтому в тестах в качестве отправителя его показания не изменяются.

## Ограничение жесткого диска (IOPS)

**Использовалось:**

- Ограничение чтения/записи с безлимитного до 10 IOPS

**Результаты:**

- Все операции линейной/случайной записи/чтения снизились до IOPS=10 (41.8KiB/S).
- Тесты без ограничений были на файле размером 100Мb, после ограничений пришлось использовать файл размером 1Mb, т.к. 100Mb обрабатывался бы 40 минут.
- В целом понижение производительности системы

***